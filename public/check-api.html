<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API é…ç½®æ£€æŸ¥</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .card {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #1890ff;
            margin-top: 0;
        }
        .status {
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
            font-size: 16px;
        }
        .success {
            background: #f6ffed;
            border: 1px solid #b7eb8f;
            color: #52c41a;
        }
        .error {
            background: #fff2f0;
            border: 1px solid #ffccc7;
            color: #ff4d4f;
        }
        .info {
            background: #e6f7ff;
            border: 1px solid #91d5ff;
            color: #1890ff;
        }
        code {
            background: #f5f5f5;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
        button {
            background: #1890ff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
        }
        button:hover {
            background: #40a9ff;
        }
    </style>
</head>
<body>
    <div class="card">
        <h1>ğŸ” API é…ç½®æ£€æŸ¥</h1>
        
        <div id="result"></div>
        
        <button onclick="testBackend()">æµ‹è¯•åç«¯è¿æ¥</button>
    </div>

    <script type="module">
        const API_BASE_URL = import.meta.env.VITE_API_BASE_URL || 'http://localhost:8080/api';
        
        const resultDiv = document.getElementById('result');
        
        // æ˜¾ç¤ºå½“å‰é…ç½®
        let html = `
            <div class="info">
                <strong>å½“å‰ API åœ°å€ï¼š</strong><br>
                <code>${API_BASE_URL}</code>
            </div>
        `;
        
        // æ£€æŸ¥é…ç½®æ˜¯å¦æ­£ç¡®
        if (API_BASE_URL.includes('localhost')) {
            html += `
                <div class="error">
                    <strong>âŒ é…ç½®é”™è¯¯ï¼</strong><br>
                    API åœ°å€ä»ç„¶æ˜¯ localhostï¼Œæ‰‹æœºæ— æ³•è®¿é—®ã€‚<br>
                    <br>
                    <strong>è§£å†³æ–¹æ¡ˆï¼š</strong><br>
                    1. ç¡®è®¤ .env æ–‡ä»¶ä¸­é…ç½®äº†æ­£ç¡®çš„ IP<br>
                    2. å®Œå…¨åœæ­¢ Vite (Ctrl+C)<br>
                    3. é‡æ–°è¿è¡Œ npm run dev
                </div>
            `;
        } else if (API_BASE_URL.includes('192.168.103.99')) {
            html += `
                <div class="success">
                    <strong>âœ… é…ç½®æ­£ç¡®ï¼</strong><br>
                    API åœ°å€å·²é…ç½®ä¸ºå†…ç½‘ IPï¼Œæ‰‹æœºå¯ä»¥è®¿é—®ã€‚
                </div>
            `;
        } else {
            html += `
                <div class="info">
                    <strong>â„¹ï¸ è‡ªå®šä¹‰é…ç½®</strong><br>
                    è¯·ç¡®è®¤è¿™æ˜¯æ‚¨æœŸæœ›çš„ API åœ°å€ã€‚
                </div>
            `;
        }
        
        resultDiv.innerHTML = html;
        
        // æµ‹è¯•åç«¯è¿æ¥
        window.testBackend = async function() {
            const testDiv = document.createElement('div');
            testDiv.className = 'info';
            testDiv.innerHTML = '<strong>â³ æ­£åœ¨æµ‹è¯•åç«¯è¿æ¥...</strong>';
            resultDiv.appendChild(testDiv);
            
            try {
                const response = await fetch(`${API_BASE_URL}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        username: 'test',
                        password: 'test'
                    })
                });
                
                testDiv.className = 'success';
                testDiv.innerHTML = `
                    <strong>âœ… åç«¯è¿æ¥æˆåŠŸï¼</strong><br>
                    çŠ¶æ€ç : ${response.status}<br>
                    åç«¯å¯ä»¥æ­£å¸¸è®¿é—®ã€‚
                `;
            } catch (error) {
                testDiv.className = 'error';
                testDiv.innerHTML = `
                    <strong>âŒ åç«¯è¿æ¥å¤±è´¥ï¼</strong><br>
                    é”™è¯¯: ${error.message}<br>
                    <br>
                    <strong>å¯èƒ½çš„åŸå› ï¼š</strong><br>
                    1. åç«¯æœåŠ¡æœªå¯åŠ¨<br>
                    2. é˜²ç«å¢™é˜»æ­¢äº† 8080 ç«¯å£<br>
                    3. API åœ°å€é…ç½®é”™è¯¯
                `;
            }
        };
    </script>
</body>
</html>
